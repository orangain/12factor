## V. ビルド、リリース、実行
### ビルド、リリース、実行の3つのステージを厳密に分離する

[コードベース](/codebase)は3つのステージを経て、（開発環境ではない）デプロイへと変換される。

* *ビルドステージ* は、コードリポジトリを *ビルド* と呼ばれる実行可能な塊へと変える変換である。デプロイ作業で指定したコミットのバージョンのコードを使って、ビルドステージは[依存関係](/dependencies)を取得してローカル環境に配置し、バイナリやアセットファイルをコンパイルする。
* *リリースステージ* は、ビルドステージで生成されたビルドを受け取り、それをデプロイの現在の[設定](/config)と結合する。出来上がる *リリース* にはビルドと設定の両方が含まれ、実行環境の中ですぐにでも実行できるよう準備が整う。
* *実行ステージ* （ランタイムとも呼ばれる）は、選択したリリースに対して、アプリケーションのいくつかの[プロセス](/processes)を起動することで、アプリケーションを実行環境の中で実行する。

![コードがビルドになり、ビルドと設定が結合されてリリースが作られる。](/images/release.png)

**Twelve-Factor Appは、ビルド、リリース、実行の3つのステージを厳密に分離する。** 例えば、実行ステージにあるコードを変更してもその変更をビルドステージに伝える方法がないため、コードを実行中に変更することはあり得ない。

デプロイツールは通常リリース管理ツールを提供する。中でも注目すべきは、以前のリリースにロールバックする機能である。例えばデプロイツールの[Capistrano](https://github.com/capistrano/capistrano/wiki)は、リリースを`releases`という名前のサブディレクトリに格納し、現在のリリースは現在のリリースのディレクトリへのシンボリックリンクである。Capistranoの`rollback`コマンドを使うと、以前のリリースに即座にロールバックすることが簡単にできる。

すべてのリリースは常に一意のリリースIDを持つべきである。リリースIDの例としては、リリースのタイムスタンプ（例：`2011-04-06-20:32:17`）や連番（例：`v100`）がある。リリースは追記専用の台帳であり、一度作られたリリースは変更することができない。変更する場合は新しいリリースを作らなければならない。

ビルドは、新しいコードがデプロイされるときに必ずアプリケーションの開発者によって開始される。一方実行は、サーバーの再起動時や、クラッシュしたプロセスがプロセスマネージャーによって再起動された時などに自動で開始される。このため、実行ステージはできるだけ可変部分を持たないようにするべきである。アプリケーションが実行できなくなる問題は、開発者が待機していない真夜中に壊れる原因になるのだから。ビルドステージはもっと複雑でも構わない。デプロイを実行している開発者の目の前でエラーが発生するのだから。
